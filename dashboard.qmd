---
title: "안전한 야간운전을 위한 위험구역 시각화"
format: dashboard
server: shiny
---


```{python}
# shiny + plotly
from shiny import App, ui, render
import plotly.graph_objects as go

# ------------------------
# 샘플 데이터 (실제 CSV 대신)
# ------------------------
# 가로등
df_000 = {'lat':[36.82,36.825], 'lon':[127.12,127.125], 'name':['가로등1','가로등2']}
# CCTV
df4 = {'lat':[36.823,36.827], 'lon':[127.122,127.127], 'name':['CCTV1','CCTV2']}
# 학교
df_천안 = {'lat':[36.824,36.828], 'lon':[127.123,127.128], 'name':['학교1','학교2']}
# 킥라니
df6 = {'lat':[36.826,36.829], 'lon':[127.124,127.129], 'name':['킥라니1','킥라니2']}

# ------------------------
# UI
# ------------------------
app_ui = ui.page_fluid(
    ui.h2("안전한 야간운전을 위한 위험구역 시각화"),
    ui.row(
        ui.column(3,
            ui.input_checkbox_group(
                "facility",
                "표시할 시설 선택",
                choices=["가로등","CCTV","학교","킥라니"],
                selected=["가로등","CCTV","학교","킥라니"]
            )
        ),
        ui.column(9,
            ui.output_plot("map_plot")
        )
    )
)

# ------------------------
# Server
# ------------------------
def server(input, output, session):
    @output
    @render.plot
    def map_plot():
        fig = go.Figure()
        # 시설별 체크
        if "가로등" in input.facility():
            fig.add_trace(go.Scattermapbox(
                lat=df_000['lat'], lon=df_000['lon'],
                mode="markers", marker=dict(size=10,color="yellow"),
                name="가로등"
            ))
        if "CCTV" in input.facility():
            fig.add_trace(go.Scattermapbox(
                lat=df4['lat'], lon=df4['lon'],
                mode="markers", marker=dict(size=10,color="green"),
                name="CCTV"
            ))
        if "학교" in input.facility():
            fig.add_trace(go.Scattermapbox(
                lat=df_천안['lat'], lon=df_천안['lon'],
                mode="markers", marker=dict(size=10,color="purple"),
                name="학교"
            ))
        if "킥라니" in input.facility():
            fig.add_trace(go.Scattermapbox(
                lat=df6['lat'], lon=df6['lon'],
                mode="markers", marker=dict(size=10,color="black"),
                name="킥라니"
            ))

        fig.update_layout(
            mapbox_style="open-street-map",
            mapbox_center={"lat":36.825, "lon":127.125},
            mapbox_zoom=13,
            height=600,
            margin={"r":0,"t":0,"l":0,"b":0}
        )
        return fig

# ------------------------
# App 실행
# ------------------------
app = App(app_ui, server)

```